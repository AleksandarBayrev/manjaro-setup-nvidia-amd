define("discourse/plugins/retort/discourse/connectors/above-site-header/emoji-picker-wrapper",["exports","../../lib/retort"],function(e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={setupComponent:function(e,t){i.default.setPicker(t)}}}),define("discourse/plugins/retort/discourse/lib/retort",["exports","discourse/lib/ajax","discourse/lib/ajax-error"],function(e,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Object.create({topic:{postStream:{posts:[]}},initialize:function(e,t){var o=this;this.topic.id&&e.unsubscribe("/retort/topics/"+this.topic.id),this.set("topic",t),e.subscribe("/retort/topics/"+this.topic.id,function(e){var t=e.id,i=e.retorts,r=o.postFor(t);r&&(r.setProperties({retorts:i}),o.get("widgets."+t).scheduleRerender())})},postFor:function(t){return(this.get("topic.postStream.posts")||[]).find(function(e){return e.id==t})},storeWidget:function(e){this.get("widgets")||this.set("widgets",{}),this.set("widgets."+e.getModel().id,e.widget)},updateRetort:function(e,t){var i=e.id;return(0,r.ajax)("/retorts/"+i+".json",{type:"POST",data:{retort:t}}).catch(o.popupAjaxError)},disabledCategories:function(){return _.compact(_.invoke(Discourse.SiteSettings.retort_disabled_categories.split("|"),"toLowerCase"))},disabledFor:function(e){var t=this.postFor(e);if(!t)return!0;if(!t.topic.details.can_create_post)return!0;var i=this.disabledCategories(),r=_.toString(t.get("topic.category.name")).toLowerCase();return i.includes(r)||t.get("topic.archived")},openPicker:function(e){this.set("picker.active",!0),this.set("picker.post",e)},setPicker:function(t){var i=this;this.set("picker",t),this.set("picker.emojiSelected",function(e){return i.updateRetort(t.post,e).then(function(){return t.set("active",!1)})})}})}),Ember.TEMPLATES["javascripts/connectors/above-site-header/emoji-picker-wrapper"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"emoji-picker",null,[["retort","active","emojiSelected","automaticPositioning"],[true,[24,["active"]],[24,["emojiSelected"]],false]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/above-site-header/emoji-picker-wrapper"}}),define("discourse/plugins/retort/discourse/widgets/retort-toggle",["exports","virtual-dom","discourse/lib/text","discourse/widgets/widget","../lib/retort"],function(e,r,o,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(0,t.createWidget)("retort-toggle",{tagName:"button.post-retort",buildKey:function(e){return"retort-toggle-"+e.emoji+"-"+e.usernames.length},defaultState:function(e){return{emoji:e.emoji,post:e.post,usernames:e.usernames}},click:function(){var e=this.state,t=e.post,i=e.emoji;s.default.updateRetort(t,i)},html:function(){var e=this.state,t=e.emoji,i=e.usernames;return[(0,r.h)("img.emoji",{src:(0,o.emojiUrlFor)(t),alt:":"+t+":"}),1<i.length?(0,r.h)("span.post-retort__count",i.length.toString()):"",(0,r.h)("span.post-retort__tooltip",this.sentence(this.state))]},sentence:function(e){var t=e.usernames,i=e.emoji,r=void 0;switch(t.length){case 1:r="retort.reactions.one_person";break;case 2:r="retort.reactions.two_people";break;default:r="retort.reactions.many_people"}return I18n.t(r,{emoji:i,first:t[0],second:t[1],count:t.length-2})}})}),define("discourse/plugins/retort/discourse/initializers/retort-init",["exports","discourse/lib/plugin-api","discourse/lib/text","@ember/runloop","discourse-common/utils/decorators","discourse/routes/topic","../lib/retort","discourse/models/user"],function(e,t,l,d,p,i,f,m){"use strict";function g(i,r,e,t,o){var s={};return Object.keys(t).forEach(function(e){s[e]=t[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=e.slice().reverse().reduce(function(e,t){return t(i,r,e)||e},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(i,r,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"retort-button",initialize:function(){(0,t.withPluginApi)("0.8.6",function(e){return s=(t=e).container.lookup("site-settings:main"),n=s.retort_enabled,c=s.retort_allowed_emojis,a=s.retort_limited_emoji_set,u=t.container.lookup("message-bus:main"),t.decorateWidget("post-contents:after-cooked",function(r){var e=r.getModel().id,o=f.default.postFor(e);if(!f.default.disabledFor(e))return f.default.storeWidget(r),_.map(o.retorts,function(e){var t=e.usernames,i=e.emoji;return r.attach("retort-toggle",{post:o,usernames:t,emoji:i})})}),void(m.default.current()&&n&&(t.modifyClass("route:topic",{setupController:function(e,t){f.default.initialize(u,t),this._super(e,t)}}),t.addPostMenuButton("retort",function(e){if(!f.default.disabledFor(e.id))return{action:"clickRetort",icon:"far-smile",title:"retort.title",position:"first"}}),t.attachWidgetAction("post-menu","clickRetort",function(){f.default.openPicker(this.findAncestorModel())}),t.modifyClass("component:emoji-picker",(i=(0,p.default)("retort"),r=(0,p.default)("retort","active"),g(o={classNameBindings:["retort:emoji-picker--retort","limited:emoji-picker--retort-limited","activeRetort:emoji-picker--retort-active"],limited:function(){return this.retort&&a},activeRetort:function(){return this.retort&&this.active},show:function(){var e=this;if(!this.limited)return this._super();var t=c.split("|"),i=100/this._emojisPerRow[t.length]||5;(0,d.schedule)("afterRender",this,function(){e.$picker.find(".main-column").html("\n          <div class='section-group'>\n            "+t.map(function(e){return"<button\n              style='flex-basis: "+i+"%; background-image: url("+(0,l.emojiUrlFor)(e)+")'\n              type='button'\n              title='"+e+"'\n              class='emoji' />"}).join("")+"\n          </div>\n        "),e._positionPicker(),e._bindModalClick(),e._bindEmojiClick(e.$picker.find(".section-group")),e.$modal.addClass("fadeIn")})},_recentEmojisChanged:function(){if(!this.limited)return this._super()},_emojisPerRow:{0:1,1:1,2:2,3:3,4:4,5:5,6:3,7:3,8:4,9:3,10:5,11:5,12:4,13:5,14:7,15:5,16:4,17:5,18:6,19:6,20:5,21:7,22:5,23:5,24:6}},"limited",[i],Object.getOwnPropertyDescriptor(o,"limited"),o),g(o,"activeRetort",[r],Object.getOwnPropertyDescriptor(o,"activeRetort"),o),o))));var t,i,r,o,s,n,c,a,u})}}});
//# sourceMappingURL=/assets/plugins/retort-7b2b2253b7ad1fc79287a3f9b4fe54930a609faefe2b324b86a589024be51965.js.map